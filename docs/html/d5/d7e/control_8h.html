<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GENERIC_SERVER: framework/control.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="../../classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="../../files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="../../globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>framework/control.h File Reference</h1>Master program that initiates GENERIC_SERVER, spawns a thread for each plug-in and runs message loop for that plug-in. <a href="#_details">More...</a>
<p>
<code>#include &lt;map&gt;</code><br>
<code>#include &lt;vector&gt;</code><br>
<code>#include &lt;iostream&gt;</code><br>
<code>#include &lt;iomanip&gt;</code><br>
<code>#include &lt;fstream&gt;</code><br>
<code>#include &lt;pthread.h&gt;</code><br>
<code>#include &quot;<a class="el" href="../../d7/d6b/sslserver_8h-source.html">sslserver.h</a>&quot;</code><br>

<p>
<a href="../../df/dca/control_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="f540173be0134f58ad144c8103fac352"></a><!-- doxytag: member="control.h::TLS_REQ" ref="f540173be0134f58ad144c8103fac352" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#f540173be0134f58ad144c8103fac352">TLS_REQ</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="48e31436e1e9f703c04f83ae4313bf47"></a><!-- doxytag: member="control.h::SOCKET_REQ" ref="48e31436e1e9f703c04f83ae4313bf47" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#48e31436e1e9f703c04f83ae4313bf47">SOCKET_REQ</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="25e1f4f654f2c462be51410c7212c288"></a><!-- doxytag: member="control.h::PR_SET_NAME" ref="25e1f4f654f2c462be51410c7212c288" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#25e1f4f654f2c462be51410c7212c288">PR_SET_NAME</a>&nbsp;&nbsp;&nbsp;15</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="ec013e17570e070cc08889b60a602940"></a><!-- doxytag: member="control.h::sig_int" ref="ec013e17570e070cc08889b60a602940" args="(int sig_num)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#ec013e17570e070cc08889b60a602940">sig_int</a> (int sig_num)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="f541909d71795b461b9de8faa5a77c86"></a><!-- doxytag: member="control.h::do_nothing" ref="f541909d71795b461b9de8faa5a77c86" args="(int sig_num)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#f541909d71795b461b9de8faa5a77c86">do_nothing</a> (int sig_num)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="4db72bad2da3cc98a24912ce94d3104e"></a><!-- doxytag: member="control.h::thread_fn" ref="4db72bad2da3cc98a24912ce94d3104e" args="(void *inp_arg)" -->
void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#4db72bad2da3cc98a24912ce94d3104e">thread_fn</a> (void *inp_arg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="810060ccb1167943e6b1e40d8e2f63e5"></a><!-- doxytag: member="control.h::ssl_thread_fn" ref="810060ccb1167943e6b1e40d8e2f63e5" args="(void *inp_arg)" -->
void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#810060ccb1167943e6b1e40d8e2f63e5">ssl_thread_fn</a> (void *inp_arg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="813220e1406b223934982dea5a3de781"></a><!-- doxytag: member="control.h::daemonize" ref="813220e1406b223934982dea5a3de781" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#813220e1406b223934982dea5a3de781">daemonize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="f47511a82a476485deeedf3af63e4638"></a><!-- doxytag: member="control.h::get_data_size" ref="f47511a82a476485deeedf3af63e4638" args="(unsigned char *recvbuf)" -->
unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#f47511a82a476485deeedf3af63e4638">get_data_size</a> (unsigned char *recvbuf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="d6c970c618ff39d4f5a8b9dfded319d2"></a><!-- doxytag: member="control.h::add_size" ref="d6c970c618ff39d4f5a8b9dfded319d2" args="(unsigned char *recvbuf, unsigned int size)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#d6c970c618ff39d4f5a8b9dfded319d2">add_size</a> (unsigned char *recvbuf, unsigned int size)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="d81c01ddd9b1aed33fafb1a306c83199"></a><!-- doxytag: member="control.h::get_input_plugin_name" ref="d81c01ddd9b1aed33fafb1a306c83199" args="(char *buffer)" -->
string&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#d81c01ddd9b1aed33fafb1a306c83199">get_input_plugin_name</a> (char *buffer)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#cfa7466ead0c0709b26b6243bd441083">process_client_req</a> (SOCKET clnt_sock, int plugin_init_state, <a class="el" href="../../d9/ddf/classgeneric__plugin.html">GENERIC_PLUGIN</a> *plugin_p, int thread_no, <a class="el" href="../../d8/d97/classgeneric__server.html">generic_server</a> *framework)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#7af98e6a051b4081cc967e2d40a51f71">process_ssl_client_req</a> (SOCKET clnt_sock, SSL *ssl, int plugin_init_state, <a class="el" href="../../d9/ddf/classgeneric__plugin.html">GENERIC_PLUGIN</a> *plugin_p, int thread_no, <a class="el" href="../../d8/d97/classgeneric__server.html">generic_server</a> *framework)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#47583803cc6bde2b25e526935f4ad636">terminate_client_session</a> (SOCKET clnt_sock, <a class="el" href="../../d8/d97/classgeneric__server.html">generic_server</a> *framework, <a class="el" href="../../d9/ddf/classgeneric__plugin.html">GENERIC_PLUGIN</a> *plugin_p, int thread_no, unsigned char *senduf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#23a438350856a338549d8df86babdb14">terminate_ssl_client_session</a> (SSL *ssl, <a class="el" href="../../d8/d97/classgeneric__server.html">generic_server</a> *framework, <a class="el" href="../../d9/ddf/classgeneric__plugin.html">GENERIC_PLUGIN</a> *plugin_p, int thread_no, unsigned char *senduf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="7bdca0961c4f70db61648bfa513703da"></a><!-- doxytag: member="control.h::print_source_hostname" ref="7bdca0961c4f70db61648bfa513703da" args="(int clnt_sock, int req_type, generic_server *framework, int thread_no, GENERIC_PLUGIN *plugin_p)" -->
static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#7bdca0961c4f70db61648bfa513703da">print_source_hostname</a> (int clnt_sock, int req_type, <a class="el" href="../../d8/d97/classgeneric__server.html">generic_server</a> *framework, int thread_no, <a class="el" href="../../d9/ddf/classgeneric__plugin.html">GENERIC_PLUGIN</a> *plugin_p)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="c3e43280d37fd63e14821b08ee8e1768"></a><!-- doxytag: member="control.h::process_data" ref="c3e43280d37fd63e14821b08ee8e1768" args="(void)" -->
static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#c3e43280d37fd63e14821b08ee8e1768">process_data</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Main loop to 'select()' sockets from multiple clients. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="d8d20d55cb7b02b868e08e6b84dc366c"></a><!-- doxytag: member="control.h::init_sock_fds" ref="d8d20d55cb7b02b868e08e6b84dc366c" args="(fd_set *, SOCKET)" -->
static unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#d8d20d55cb7b02b868e08e6b84dc366c">init_sock_fds</a> (fd_set *, SOCKET)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="43b912bf4961b4c8ece390f761476d40"></a><!-- doxytag: member="control.h::chk_command_sock" ref="43b912bf4961b4c8ece390f761476d40" args="(fd_set *, SOCKET)" -->
static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#43b912bf4961b4c8ece390f761476d40">chk_command_sock</a> (fd_set *, SOCKET)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#772877a4bdcaa73a75d860486ab820a4">launch_thread</a> (<a class="el" href="../../d9/ddf/classgeneric__plugin.html">GENERIC_PLUGIN</a> *<a class="el" href="../../d9/ddf/classgeneric__plugin.html">generic_plugin</a>, unsigned int new_slot)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="c9d4470e036434b43b2ed761ad25c351"></a><!-- doxytag: member="control.h::chk_all_clients" ref="c9d4470e036434b43b2ed761ad25c351" args="(fd_set *socks)" -->
static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d7e/control_8h.html#c9d4470e036434b43b2ed761ad25c351">chk_all_clients</a> (fd_set *socks)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="299635148006044c831bb41b107a3ab8"></a><!-- doxytag: member="control.h::read_socket" ref="299635148006044c831bb41b107a3ab8" args="(unsigned char *buffer, SOCKET sock, int size)" -->
static int&nbsp;</td><td class="memItemRight" valign="bottom"><b>read_socket</b> (unsigned char *buffer, SOCKET sock, int size)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Master program that initiates GENERIC_SERVER, spawns a thread for each plug-in and runs message loop for that plug-in. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>Suraj Vijayan</dd></dl>
<dl compact><dt><b>Date:</b></dt><dd>: 2013/07/01 14:16:20</dd></dl>
Contact: <a href="mailto:suraj@broadcom.com">suraj@broadcom.com</a> 
<p>
Definition in file <a class="el" href="../../df/dca/control_8h-source.html">control.h</a>.<hr><h2>Function Documentation</h2>
<a class="anchor" name="772877a4bdcaa73a75d860486ab820a4"></a><!-- doxytag: member="control.h::launch_thread" ref="772877a4bdcaa73a75d860486ab820a4" args="(GENERIC_PLUGIN *generic_plugin, unsigned int new_slot)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int launch_thread           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/ddf/classgeneric__plugin.html">GENERIC_PLUGIN</a> *&nbsp;</td>
          <td class="paramname"> <em>generic_plugin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>new_slot</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Launches a new thread to run a plug-in. Thread could be for an TLS session or a non-TLS session.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>plugin_p</em>&nbsp;</td><td>Pointer to <a class="el" href="../../d9/ddf/classgeneric__plugin.html">generic_plugin</a> object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>new_slot</em>&nbsp;</td><td>slot position into thread_ids map </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>1 always </dd></dl>

<p>
Definition at line <a class="el" href="../../dd/d8c/control_8cpp-source.html#l00689">689</a> of file <a class="el" href="../../dd/d8c/control_8cpp-source.html">control.cpp</a>.
<p>
References <a class="el" href="../../de/dd9/generic__server_8cpp-source.html#l00802">generic_server::close_thread_ids()</a>, <a class="el" href="../../de/dd9/generic__server_8cpp-source.html#l00228">generic_server::get_thread_sync_mutex()</a>, <a class="el" href="../../d3/dd8/generic__plugin_8cpp-source.html#l00267">generic_plugin::get_tls_flag()</a>, <a class="el" href="../../d0/d3a/generic__server_8h-source.html#l00187">generic_server::pinstance</a>, and <a class="el" href="../../d0/d3a/generic__server_8h-source.html#l00185">generic_server::thread_ids</a>.<div class="fragment"><pre class="fragment"><a name="l00690"></a>00690 {
<a name="l00691"></a>00691     <a class="code" href="../../d8/d97/classgeneric__server.html">generic_server</a> *fwork = <a class="code" href="../../d8/d97/classgeneric__server.html#3071e1b18f12acfc8ab5adcd0f8e4d46">generic_server::pinstance</a>;
<a name="l00692"></a>00692 <span class="preprocessor">#ifdef LINUX</span>
<a name="l00693"></a>00693 <span class="preprocessor"></span>        pthread_attr_t attr; <span class="comment">// thread attribute</span>
<a name="l00694"></a>00694                                                  <span class="comment">// set thread detachstate attribute to DETACHED </span>
<a name="l00695"></a>00695     fwork-&gt;<a class="code" href="../../d8/d97/classgeneric__server.html#215c34721e56d68e0f01ecde3b32ac05">get_thread_sync_mutex</a>();
<a name="l00696"></a>00696     pthread_attr_init(&amp;attr);
<a name="l00697"></a>00697     pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_DETACHED);
<a name="l00698"></a>00698 <span class="preprocessor">#endif</span>
<a name="l00699"></a>00699 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(generic_plugin-&gt;<a class="code" href="../../d9/ddf/classgeneric__plugin.html#f98679e1732de39b106e9e486ba5de04">get_tls_flag</a>())
<a name="l00700"></a>00700     {
<a name="l00701"></a>00701 #ifdef WINDOWS
<a name="l00702"></a>00702         fwork-&gt;<a class="code" href="../../d8/d97/classgeneric__server.html#215c34721e56d68e0f01ecde3b32ac05">get_thread_sync_mutex</a>();
<a name="l00703"></a>00703                 fwork-&gt;<a class="code" href="../../d8/d97/classgeneric__server.html#30f76d8a32fadebba59ae4cd81324e6c">thread_ids</a>[new_slot].th = (HANDLE)_beginthreadex(NULL, 0, &amp;ssl_thread_fn, (<span class="keywordtype">void</span> *)generic_plugin, 0, NULL );
<a name="l00704"></a>00704 <span class="preprocessor">#else</span>
<a name="l00705"></a>00705 <span class="preprocessor"></span>        pthread_create(&amp;fwork-&gt;<a class="code" href="../../d8/d97/classgeneric__server.html#30f76d8a32fadebba59ae4cd81324e6c">thread_ids</a>[new_slot].th,&amp;attr,ssl_thread_fn, (<span class="keywordtype">void</span> *)generic_plugin);
<a name="l00706"></a>00706 <span class="preprocessor">#endif</span>
<a name="l00707"></a>00707 <span class="preprocessor"></span>    }
<a name="l00708"></a>00708     <span class="keywordflow">else</span>
<a name="l00709"></a>00709     {
<a name="l00710"></a>00710 <span class="preprocessor">#ifdef WINDOWS</span>
<a name="l00711"></a>00711 <span class="preprocessor"></span>        fwork-&gt;<a class="code" href="../../d8/d97/classgeneric__server.html#215c34721e56d68e0f01ecde3b32ac05">get_thread_sync_mutex</a>();
<a name="l00712"></a>00712                 fwork-&gt;<a class="code" href="../../d8/d97/classgeneric__server.html#30f76d8a32fadebba59ae4cd81324e6c">thread_ids</a>[new_slot].th = (HANDLE)_beginthreadex(NULL, 0, &amp;thread_fn, (<span class="keywordtype">void</span> *)generic_plugin, 0, NULL );
<a name="l00713"></a>00713 <span class="preprocessor">#else</span>
<a name="l00714"></a>00714 <span class="preprocessor"></span>        pthread_create(&amp;fwork-&gt;<a class="code" href="../../d8/d97/classgeneric__server.html#30f76d8a32fadebba59ae4cd81324e6c">thread_ids</a>[new_slot].th,&amp;attr,thread_fn, (<span class="keywordtype">void</span> *)generic_plugin);
<a name="l00715"></a>00715 <span class="preprocessor">#endif</span>
<a name="l00716"></a>00716 <span class="preprocessor"></span>    }
<a name="l00717"></a>00717 <span class="preprocessor">#ifdef LINUX</span>
<a name="l00718"></a>00718 <span class="preprocessor"></span>    pthread_attr_destroy(&amp;attr);
<a name="l00719"></a>00719 <span class="preprocessor">#endif</span>
<a name="l00720"></a>00720 <span class="preprocessor"></span>    fwork-&gt;<a class="code" href="../../d8/d97/classgeneric__server.html#dbf41451c13ef0afda5915d970fff1a5">close_thread_ids</a>();
<a name="l00721"></a>00721     <span class="keywordflow">return</span>(1);
<a name="l00722"></a>00722 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="cfa7466ead0c0709b26b6243bd441083"></a><!-- doxytag: member="control.h::process_client_req" ref="cfa7466ead0c0709b26b6243bd441083" args="(SOCKET clnt_sock, int plugin_init_state, GENERIC_PLUGIN *plugin_p, int thread_no, generic_server *framework)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int process_client_req           </td>
          <td>(</td>
          <td class="paramtype">SOCKET&nbsp;</td>
          <td class="paramname"> <em>clnt_sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>plugin_init_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/ddf/classgeneric__plugin.html">GENERIC_PLUGIN</a> *&nbsp;</td>
          <td class="paramname"> <em>plugin_p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>thread_no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d8/d97/classgeneric__server.html">generic_server</a> *&nbsp;</td>
          <td class="paramname"> <em>framework</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function gets called in a plug-in specific thread to process request sent by client on raw (non TLS) session. Once a valid request is received, 'process_request()' method on plug-in is invoked. Message structure: <ul>
<li>SIGNATURE - 4 bytes SIGNATURE for all messages </li>
<li>PAYLOAD_SIZE - 4 bytes network byte order </li>
<li>DATA - PAYLOAD_SIZE data </li>
<li>Data payload could be: </li>
<li>PLUGIN_NAME_LEN - 4 bytes network byte order </li>
<li>PLUGIN_NAME - Size as defined by &lt;PLUGIN_NAME_LEN&gt; </li>
<li>APPLICATION_DATA - PAYLOAD_SIZE-(4+PLUGIN_NAME_LEN)</li>
</ul>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>clnt_sock</em>&nbsp;</td><td>Client socket to read/write </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>plugin_init_state</em>&nbsp;</td><td>Flag to indicate return status of plugin_init() callback </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>plugin_p</em>&nbsp;</td><td>Pointer to plug-in object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>thread_no</em>&nbsp;</td><td>Thread number assigned by framework </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>framework</em>&nbsp;</td><td>Pointer to framework object </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>1 on success, 0 on failure </dd></dl>

<p>
Referenced by <a class="el" href="../../dd/d8c/control_8cpp-source.html#l00067">thread_fn()</a>.
</div>
</div><p>
<a class="anchor" name="7af98e6a051b4081cc967e2d40a51f71"></a><!-- doxytag: member="control.h::process_ssl_client_req" ref="7af98e6a051b4081cc967e2d40a51f71" args="(SOCKET clnt_sock, SSL *ssl, int plugin_init_state, GENERIC_PLUGIN *plugin_p, int thread_no, generic_server *framework)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int process_ssl_client_req           </td>
          <td>(</td>
          <td class="paramtype">SOCKET&nbsp;</td>
          <td class="paramname"> <em>clnt_sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SSL *&nbsp;</td>
          <td class="paramname"> <em>ssl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>plugin_init_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/ddf/classgeneric__plugin.html">GENERIC_PLUGIN</a> *&nbsp;</td>
          <td class="paramname"> <em>plugin_p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>thread_no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d8/d97/classgeneric__server.html">generic_server</a> *&nbsp;</td>
          <td class="paramname"> <em>framework</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function gets called in a plug-in specific thread to process request sent by client on TLS enabled session. Once a valid request is received, 'process_request()' method on plug-in is invoked. Message structure: <ul>
<li>SIGNATURE - 4 bytes SIGNATURE for all messages </li>
<li>PAYLOAD_SIZE - 4 bytes network byte order </li>
<li>DATA - PAYLOAD_SIZE data </li>
<li>Data payload could be: </li>
<li>PLUGIN_NAME_LEN - 4 bytes network byte order </li>
<li>PLUGIN_NAME - Size as defined by &lt;PLUGIN_NAME_LEN&gt; </li>
<li>APPLICATION_DATA - PAYLOAD_SIZE-(4+PLUGIN_NAME_LEN)</li>
</ul>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>clnt_sock</em>&nbsp;</td><td>Client socket attached to SSL </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ssl</em>&nbsp;</td><td>Pointer to SSL structure </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>plugin_init_state</em>&nbsp;</td><td>Flag to indicate return status of plugin_init() callback </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>thread_no</em>&nbsp;</td><td>Thread number assigned by framework </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>framework</em>&nbsp;</td><td>Pointer to framework object </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>1 on success, 0 on failure </dd></dl>

<p>
Referenced by <a class="el" href="../../dd/d8c/control_8cpp-source.html#l00132">ssl_thread_fn()</a>.
</div>
</div><p>
<a class="anchor" name="47583803cc6bde2b25e526935f4ad636"></a><!-- doxytag: member="control.h::terminate_client_session" ref="47583803cc6bde2b25e526935f4ad636" args="(SOCKET clnt_sock, generic_server *framework, GENERIC_PLUGIN *plugin_p, int thread_no, unsigned char *senduf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int terminate_client_session           </td>
          <td>(</td>
          <td class="paramtype">SOCKET&nbsp;</td>
          <td class="paramname"> <em>clnt_sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d8/d97/classgeneric__server.html">generic_server</a> *&nbsp;</td>
          <td class="paramname"> <em>framework</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/ddf/classgeneric__plugin.html">GENERIC_PLUGIN</a> *&nbsp;</td>
          <td class="paramname"> <em>plugin_p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>thread_no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>senduf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function gets called in a plug-in specific thread whenever a non-TLS client session is to be terminated.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>clnt_socket</em>&nbsp;</td><td>Client socket to read/write </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>framework</em>&nbsp;</td><td>Pointer to framework object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>plugin_p</em>&nbsp;</td><td>Pointer to plugin object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>thread_no</em>&nbsp;</td><td>Thread number assigned by framework </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>sendbuf</em>&nbsp;</td><td>NULL terminated ASCII data to send to client </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>1 always </dd></dl>

<p>
Definition at line <a class="el" href="../../dd/d8c/control_8cpp-source.html#l00416">416</a> of file <a class="el" href="../../dd/d8c/control_8cpp-source.html">control.cpp</a>.
<p>
References <a class="el" href="../../d3/dd8/generic__plugin_8cpp-source.html#l00237">generic_plugin::get_plugin_name()</a>, <a class="el" href="../../de/dd9/generic__server_8cpp-source.html#l00094">generic_server::log()</a>, <a class="el" href="../../d0/d3a/generic__server_8h-source.html#l00049">LOG_LOW</a>, <a class="el" href="../../de/dd9/generic__server_8cpp-source.html#l00776">generic_server::rel_thread_id()</a>, <a class="el" href="../../da/ddb/generic__plugin_8h-source.html#l00215">generic_plugin::shutdown_plugin()</a>, and <a class="el" href="../../de/dd9/generic__server_8cpp-source.html#l00655">generic_server::socket_close()</a>.<div class="fragment"><pre class="fragment"><a name="l00417"></a>00417 {
<a name="l00418"></a>00418     <span class="keywordtype">int</span> len;
<a name="l00419"></a>00419     ostringstream os;
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     len = strlen((<span class="keywordtype">char</span> *)sendbuf);
<a name="l00422"></a>00422     send(clnt_sock, (<span class="keywordtype">char</span> *)sendbuf, (<span class="keywordtype">int</span>)len, 0 );
<a name="l00423"></a>00423     plugin_p-&gt;<a class="code" href="../../d9/ddf/classgeneric__plugin.html#6c1da54f389da73d56a1496963ba71f3">shutdown_plugin</a>(); <span class="comment">// Aborting SESSION..</span>
<a name="l00424"></a>00424     os.str(<span class="stringliteral">""</span>);
<a name="l00425"></a>00425     os.clear();
<a name="l00426"></a>00426     os  &lt;&lt; <span class="stringliteral">" Thr.ID:"</span> &lt;&lt; thread_no &lt;&lt; <span class="stringliteral">" Plugin:"</span> &lt;&lt; plugin_p-&gt;<a class="code" href="../../d9/ddf/classgeneric__plugin.html#a9147641595f28a5762c9e4e35241fe6">get_plugin_name</a>() &lt;&lt; <span class="stringliteral">" Quitting thread."</span> &lt;&lt; sendbuf;
<a name="l00427"></a>00427     fwork-&gt;log(<a class="code" href="../../d7/d71/generic__server_8h.html#319b3d81d98069eab40e6da17932252a">LOG_LOW</a>,<a class="code" href="../../d7/d71/generic__server_8h.html#319b3d81d98069eab40e6da17932252a">LOG_LOW</a>,os.str());
<a name="l00428"></a>00428         fwork-&gt;socket_close(clnt_sock);
<a name="l00429"></a>00429     <span class="keyword">delete</span> plugin_p;
<a name="l00430"></a>00430     fwork-&gt;rel_thread_id(thread_no);
<a name="l00431"></a>00431     <span class="keywordflow">return</span>(1);
<a name="l00432"></a>00432 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="23a438350856a338549d8df86babdb14"></a><!-- doxytag: member="control.h::terminate_ssl_client_session" ref="23a438350856a338549d8df86babdb14" args="(SSL *ssl, generic_server *framework, GENERIC_PLUGIN *plugin_p, int thread_no, unsigned char *senduf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int terminate_ssl_client_session           </td>
          <td>(</td>
          <td class="paramtype">SSL *&nbsp;</td>
          <td class="paramname"> <em>ssl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d8/d97/classgeneric__server.html">generic_server</a> *&nbsp;</td>
          <td class="paramname"> <em>framework</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/ddf/classgeneric__plugin.html">GENERIC_PLUGIN</a> *&nbsp;</td>
          <td class="paramname"> <em>plugin_p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>thread_no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>senduf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function gets called in a plug-in specific thread whenever a TLS client session is to be terminated.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ssl</em>&nbsp;</td><td>Pointer to SSL structure </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>framework</em>&nbsp;</td><td>Pointer to framework object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>plugin_p</em>&nbsp;</td><td>Pointer to plugin object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>thread_no</em>&nbsp;</td><td>Thread number assigned by framework </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>sendbuf</em>&nbsp;</td><td>NULL terminated ASCII data to send to client </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>1 always </dd></dl>

<p>
Definition at line <a class="el" href="../../dd/d8c/control_8cpp-source.html#l00435">435</a> of file <a class="el" href="../../dd/d8c/control_8cpp-source.html">control.cpp</a>.
<p>
References <a class="el" href="../../d3/dd8/generic__plugin_8cpp-source.html#l00237">generic_plugin::get_plugin_name()</a>, <a class="el" href="../../de/dd9/generic__server_8cpp-source.html#l00094">generic_server::log()</a>, <a class="el" href="../../d0/d3a/generic__server_8h-source.html#l00049">LOG_LOW</a>, <a class="el" href="../../de/dd9/generic__server_8cpp-source.html#l00776">generic_server::rel_thread_id()</a>, <a class="el" href="../../da/ddb/generic__plugin_8h-source.html#l00215">generic_plugin::shutdown_plugin()</a>, <a class="el" href="../../de/dd9/generic__server_8cpp-source.html#l00655">generic_server::socket_close()</a>, and <a class="el" href="../../de/dd9/generic__server_8cpp-source.html#l01354">generic_server::ssl_async_write()</a>.<div class="fragment"><pre class="fragment"><a name="l00436"></a>00436 {
<a name="l00437"></a>00437         <span class="keywordtype">int</span> len,ssl_response,status;
<a name="l00438"></a>00438         ostringstream os;
<a name="l00439"></a>00439         <span class="keywordtype">char</span> buf[100];
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     len = strlen((<span class="keywordtype">char</span> *)sendbuf);
<a name="l00442"></a>00442         status = recv(SSL_get_fd(ssl), (<span class="keywordtype">char</span>*) buf, 10, MSG_PEEK);
<a name="l00443"></a>00443     <span class="keywordflow">if</span>(status &gt; 0)
<a name="l00444"></a>00444         {
<a name="l00445"></a>00445                 ssl_response = fwork-&gt;ssl_async_write((SSL *)ssl,  (<span class="keywordtype">char</span> *)sendbuf, (<span class="keywordtype">int</span>)len);
<a name="l00446"></a>00446                 <span class="keywordflow">if</span>(ssl_response &gt; 0)
<a name="l00447"></a>00447                 {
<a name="l00448"></a>00448                         <span class="keywordflow">while</span>((SSL_shutdown(ssl)) == 0)
<a name="l00449"></a>00449                         ;
<a name="l00450"></a>00450                 }
<a name="l00451"></a>00451         }
<a name="l00452"></a>00452     plugin_p-&gt;<a class="code" href="../../d9/ddf/classgeneric__plugin.html#6c1da54f389da73d56a1496963ba71f3">shutdown_plugin</a>(); 
<a name="l00453"></a>00453     os  &lt;&lt; <span class="stringliteral">" Thr.ID:"</span> &lt;&lt; thread_no &lt;&lt; <span class="stringliteral">" ChipID:"</span> &lt;&lt; plugin_p-&gt;<a class="code" href="../../d9/ddf/classgeneric__plugin.html#a9147641595f28a5762c9e4e35241fe6">get_plugin_name</a>() &lt;&lt; <span class="stringliteral">" Quitting thread."</span> &lt;&lt; sendbuf;
<a name="l00454"></a>00454     fwork-&gt;log(<a class="code" href="../../d7/d71/generic__server_8h.html#319b3d81d98069eab40e6da17932252a">LOG_LOW</a>,<a class="code" href="../../d7/d71/generic__server_8h.html#319b3d81d98069eab40e6da17932252a">LOG_LOW</a>,os.str());
<a name="l00455"></a>00455         fwork-&gt;socket_close(SSL_get_fd(ssl));
<a name="l00456"></a>00456         SSL_free((SSL *)ssl);
<a name="l00457"></a>00457         ERR_free_strings();
<a name="l00458"></a>00458         ERR_remove_state(0);
<a name="l00459"></a>00459     <span class="keyword">delete</span> plugin_p;
<a name="l00460"></a>00460     fwork-&gt;rel_thread_id(thread_no);
<a name="l00461"></a>00461     <span class="keywordflow">return</span>(1);
<a name="l00462"></a>00462 }
</pre></div>
<p>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Tue Aug 6 17:08:24 2013 for GENERIC_SERVER by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
